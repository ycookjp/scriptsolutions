<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/index.md at 2024-03-04

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>Python AWS Utils &#x2013; AWS Utilities</title>
    <link rel="stylesheet" href="./css/maven-base.css" />
    <link rel="stylesheet" href="./css/maven-theme.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
<link rel="shortcut icon" href="images/favicon.ico" />
  </head>
  <body class="composite">
    <div id="banner">
<div id="bannerLeft">Python AWS Utils
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: 2024-03-04</span>
           | <span id="projectVersion">Version: 0.0.1-SNAPSHOT</span>
      </div>
      <div class="xright">      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Contents</h5>
    <ul>
     <li class="none"><a href="./test-report/python-progs.html" title="Test Report">Test Report</a></li>
     <li class="none"><a href="./htmlcov/index.html" title="Coverage Report">Coverage Report</a></li>
     <li class="none"><a href="./python-dependencies.html" title="Dependencies">Dependencies</a></li>
     <li class="none"><a href="./awsutils-0.0.1-SNAPSHOT.zip" title="Download site archive">Download site archive</a></li>
    </ul>
       <h5>APIs</h5>
    <ul>
     <li class="none"><a href="./apidocs/awsutils/index.html" title="API Documents">API Documents</a></li>
     <li class="none"><a href="./testspecs/tests/index.html" title="Test Specifications">Test Specifications</a></li>
    </ul>
       <h5>Project Documentation</h5>
    <ul>
     <li class="expanded"><a href="project-info.html" title="Project Information">Project Information</a>
      <ul>
       <li class="none"><a href="dependency-info.html" title="Dependency Information">Dependency Information</a></li>
       <li class="none"><a href="distribution-management.html" title="Distribution Management">Distribution Management</a></li>
       <li class="none"><strong>About</strong></li>
       <li class="none"><a href="licenses.html" title="Licenses">Licenses</a></li>
       <li class="none"><a href="plugin-management.html" title="Plugin Management">Plugin Management</a></li>
       <li class="none"><a href="plugins.html" title="Plugins">Plugins</a></li>
       <li class="none"><a href="summary.html" title="Summary">Summary</a></li>
      </ul></li>
    </ul>
      <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<h1>AWS Utilities</h1><section>
<h2><a name="aws_resource_start_stop_.E3.83.A2.E3.82.B8.E3.83.A5.E3.83.BC.E3.83.AB"></a>aws_resource_start_stop &#x30e2;&#x30b8;&#x30e5;&#x30fc;&#x30eb;</h2>
<p>start_stop_aws_resources &#x95a2;&#x6570;&#x3092;&#x5b9f;&#x884c;&#x3059;&#x308b;&#x3068;&#x3001;EC2&#x30a4;&#x30f3;&#x30b9;&#x30bf;&#x30f3;&#x30b9;&#x306e;&#x958b;&#x59cb;&#x3001;&#x307e;&#x305f;&#x306f;&#x505c;&#x6b62;&#x3092;
&#x884c;&#x3046;&#x3053;&#x3068;&#x304c;&#x3067;&#x304d;&#x307e;&#x3059;&#x3002;&#x958b;&#x59cb;&#xff0f;&#x505c;&#x6b62;&#x306e;&#x5bfe;&#x8c61;&#x3068;&#x306a;&#x308b;EC2&#x30a4;&#x30f3;&#x30b9;&#x30bf;&#x30f3;&#x30b9;&#x3092;&#x53c2;&#x7167;&#x3059;&#x308b;&#x305f;&#x3081;&#x306e;
&#x5b9a;&#x7fa9;&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x306e;&#x30ad;&#x30fc;&#x3001;&#x53ca;&#x3073;&#x958b;&#x59cb;&#xff0f;&#x7d42;&#x4e86;&#x306e;&#x533a;&#x5225;&#x306f;&#x3001;&#x95a2;&#x6570;&#x306e;&#x5f15;&#x6570;&#x306e; event&#x3001;&#x307e;&#x305f;&#x306f; context
&#x304b;&#x3089;&#x53d6;&#x5f97;&#x3057;&#x307e;&#x3059;&#x3002;</p>
<ul>

<li>event &#x5f15;&#x6570;
CloudWatch &#x306e;&#x30a4;&#x30d9;&#x30f3;&#x30c8;&#x30eb;&#x30fc;&#x30eb;&#x3066;&#x6307;&#x5b9a;&#x3057;&#x305f;&#x30a4;&#x30d9;&#x30f3;&#x30c8;&#x3092;&#x6307;&#x5b9a;&#x3057;&#x307e;&#x3059;&#x3002;</li>
<li>context &#x5f15;&#x6570;
Lambda &#x95a2;&#x6570; &#x306e;&#x30b3;&#x30f3;&#x30c6;&#x30ad;&#x30b9;&#x30c8;&#x3092;&#x6307;&#x5b9a;&#x3057;&#x307e;&#x3059;&#x3002;start_stop_aws_resources&#x95a2;&#x3059;&#x306f;&#x3001;
&#x3053;&#x3053;&#x304b;&#x3089; Lambda&#x95a2;&#x6570;&#x306e;&#x95a2;&#x6570;&#x540d;&#x3092;&#x53d6;&#x5f97;&#x3057;&#x307e;&#x3059;&#x3002;</li>
</ul><section>
<h3><a name="a.E5.88.A9.E7.94.A8.E6.96.B9.E6.B3.95"></a>&#x5229;&#x7528;&#x65b9;&#x6cd5;</h3>
<ol style="list-style-type: decimal">

<li>

<p>Lambda &#x95a2;&#x6570;&#x306e;&#x4f5c;&#x6210;</p>
<ul>

<li>

<p>IAM&#x30ed;&#x30fc;&#x30eb;&#x306e;&#x8a2d;&#x5b9a;</p>
<p>EC2&#x30a4;&#x30f3;&#x30b9;&#x30bf;&#x30f3;&#x30b9;&#x306e;&#x958b;&#x59cb;&#xff0f;&#x505c;&#x6b62;&#x6a29;&#x9650;&#x3092;&#x8a2d;&#x5b9a;&#x3059;&#x308b;&#x305f;&#x3081;&#x306b; IAM &#x30dd;&#x30ea;&#x30b7;&#x30fc;&#x3092;&#x4f5c;&#x6210;&#x3059;&#x308b;&#x3002;</p>

<div class="source">
<pre><code>  {
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
      {
        &quot;Effect&quot;: &quot;Allow&quot;,
        &quot;Action&quot;: [
          &quot;logs:CreateLogGroup&quot;,
          &quot;logs:CreateLogStream&quot;,
          &quot;logs:PutLogEvents&quot;
        ],
        &quot;Resource&quot;: &quot;arn:aws:logs:*:*:*&quot;
      },
      {
        &quot;Effect&quot;: &quot;Allow&quot;,
        &quot;Action&quot;: [
          &quot;ec2:Start*&quot;,
          &quot;ec2:Stop*&quot;
        ],
        &quot;Resource&quot;: &quot;*&quot;
      },
      {
        &quot;Sid&quot;: &quot;VisualEditor0&quot;,
        &quot;Effect&quot;: &quot;Allow&quot;,
        &quot;Action&quot;: [
          &quot;rds:StartDBCluster&quot;,
          &quot;rds:StopDBCluster&quot;,
          &quot;rds:ListTagsForResource&quot;,
          &quot;rds:DescribeDBInstances&quot;,
          &quot;rds:StopDBInstance&quot;,
          &quot;rds:DescribeDBClusters&quot;,
          &quot;rds:StartDBInstance&quot;
        ],
        &quot;Resource&quot;: &quot;*&quot;
      }
    ]
  }
</code></pre></div>
</li>
<li>

<p>Lambda &#x95a2;&#x6570;&#x306e;&#x4f5c;&#x6210;</p>
<p>Lambda &#x95a2;&#x6570;&#x3092;&#x4f5c;&#x6210;&#x3057;&#x3066;&#x3001;Lambda &#x95a2;&#x6570;&#x306b;&#x9069;&#x7528;&#x3057;&#x305f;&#x30ed;&#x30fc;&#x30eb;&#x306b;&#x5bfe;&#x3057;&#x3066;&#x4e0a;&#x8a18;&#x3067;&#x4f5c;&#x6210;&#x3057;&#x305f;
IAM &#x30ed;&#x30fc;&#x30eb;&#x3092;&#x30a2;&#x30bf;&#x30c3;&#x30c1;&#x3059;&#x308b;&#x3002;&#x958b;&#x59cb;&#xff0f;&#x7d42;&#x4e86;&#x5bfe;&#x8c61;&#x306e;EC2&#x30a4;&#x30f3;&#x30b9;&#x30bf;&#x30f3;&#x30b9;&#x3092;&#x53c2;&#x7167;&#x3059;&#x308b;&#x305f;&#x3081;&#x306e;
&#x8a2d;&#x5b9a;&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x306e;&#x3063;&#x30ad;&#x30fc;&#x3001;&#x53ca;&#x3073;&#x958b;&#x59cb;&#xff0f;&#x7d42;&#x4e86;&#x306e;&#x7a2e;&#x5225;&#x3092; Lambda &#x95a2;&#x6570;&#x540d;&#x304b;&#x3089;&#x53d6;&#x5f97;&#x3057;&#x305f;&#x3044;
&#x5834;&#x5408;&#x306f;&#x3001;&#x300c;CloudWatch Event &#x304b;&#x3089;&#x306e; Lambda &#x95a2;&#x6570;&#x306e;&#x547c;&#x3073;&#x51fa;&#x3057;&#x300d;&#x3067;&#x8aac;&#x660e;&#x3057;&#x305f;
&#x95a2;&#x6570;&#x540d;&#x306e;&#x30eb;&#x30fc;&#x30eb;&#x306b;&#x5f93;&#x3046;&#x3053;&#x3068;&#x3002;</p>
</li>
</ul>
</li>
<li>

<p>aws_resource_start_stop &#x30e2;&#x30b8;&#x30e5;&#x30fc;&#x30eb;&#x306e;&#x914d;&#x5099;</p>
<p>&#x4f5c;&#x6210;&#x3057;&#x305f; Lambda &#x95a2;&#x6570;&#x306e;&#x30d7;&#x30ed;&#x30b8;&#x30a7;&#x30af;&#x30c8; &#x30c7;&#x30a3;&#x30ec;&#x30af;&#x30c8;&#x30ea;&#x30fc;&#x306b;awsutils &#x30e2;&#x30b8;&#x30e5;&#x30fc;&#x30eb;
&#xff08;awsutils &#x30c7;&#x30a3;&#x30ec;&#x30af;&#x30c8;&#x30ea;&#xff09;&#x3068;&#x305d;&#x306e;&#x4f9d;&#x5b58;&#x30d1;&#x30c3;&#x30b1;&#x30fc;&#x30b8;&#x3092;&#x914d;&#x7f6e;&#x3059;&#x308b;&#x3002;</p>
<p>&#x4f9d;&#x5b58;&#x30d1;&#x30c3;&#x30b1;&#x30fc;&#x30b8;&#x306f;&#x3001;&#x30d7;&#x30ed;&#x30b8;&#x30a7;&#x30af;&#x30c8; &#x30c7;&#x30a3;&#x30ec;&#x30af;&#x30c8;&#x30ea;&#x30fc;&#x914d;&#x4e0b;&#x306b; &#x300c;requirements.txt&#x300d;&#x3092;
&#x914d;&#x7f6e;&#x3057;&#x3066;&#x3001;&#x30d7;&#x30ed;&#x30b8;&#x30a7;&#x30af;&#x30c8; &#x30c7;&#x30a3;&#x30ec;&#x30af;&#x30c8;&#x30ea;&#x30fc;&#x3067;&#x4ee5;&#x4e0b;&#x306e;&#x30b3;&#x30de;&#x30f3;&#x30c9;&#x3092;&#x5b9f;&#x884c;&#x3057;&#x3066;&#x53d6;&#x5f97;&#x3059;&#x308b;&#x3002;</p>

<div class="source">
<pre><code> python -m pip install -t . -r requirements.txt
</code></pre></div>
<p>&#x30d7;&#x30ed;&#x30b8;&#x30a7;&#x30af;&#x30c8; &#x30c7;&#x30a3;&#x30ec;&#x30af;&#x30c8;&#x30ea;&#x30fc;&#x914d;&#x4e0b;&#x306e;&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x3001;&#x30c7;&#x30a3;&#x30ec;&#x30af;&#x30c8;&#x30ea;&#x30fc;&#x3092; zip &#x306b;&#x5727;&#x7e2e;&#x3057;&#x3066;
Lambda &#x95a2;&#x6570;&#x306b;&#x914d;&#x5099;&#x3059;&#x308b;&#x3002;</p>
</li>
<li>

<p>Lambda &#x95a2;&#x6570;&#x304b;&#x3089;&#x306e; start_stop_aws_resources &#x95a2;&#x6570;&#x306e;&#x547c;&#x3073;&#x51fa;&#x3057;</p>
<p>Lambda &#x95a2;&#x6570;&#x306e;&#x30d7;&#x30ed;&#x30b8;&#x30a7;&#x30af;&#x30c8; &#x30c7;&#x30a3;&#x30ec;&#x30af;&#x30c8;&#x30ea;&#x30fc;&#x914d;&#x4e0b;&#x306e;&#x300c;lambda_function.py&#x300d;
&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x306b;&#x4ee5;&#x4e0b;&#x306e;&#x30b3;&#x30fc;&#x30c9;&#x3092;&#x5b9f;&#x88c5;&#x3059;&#x308b;&#xff08;evemt &#x5f15;&#x6570;&#x304b;&#x3089; EC2 &#x306e;&#x8d77;&#x52d5;&#xff0f;&#x505c;&#x6b62;&#x306e;&#x60c5;&#x5831;&#x3092;
&#x53d6;&#x5f97;&#x3059;&#x308b;&#x5834;&#x5408;&#xff09;&#x3002;</p>

<div class="source">
<pre><code> from awsutils import aws_resource_start_stop
 import logging
 import sys
 import traceback

 root = logging.getLogger()
 if root.handlers:
     for handler in root.handlers:
         root.removeHandler(handler)
 logging.basicConfig(stream=sys.stdout, level=logging.INFO)

 def lambda_handler(event, context):
     try:
         aws_resource_start_stop.start_stop_aws_resources(event, context)
         return 0
     except Exception  as e:
         logging.error(str(e.__class__) + ': ' +  str(e))
         traceback.print_stack(file=sys.stdout)
         raise
</code></pre></div>
<p>Lambda &#x95a2;&#x6570;&#x540d;&#x304b;&#x3089; EC2 &#x306e;&#x8d77;&#x52d5;&#xff0f;&#x505c;&#x6b62;&#x306e;&#x60c5;&#x5831;&#x3092;&#x53d6;&#x5f97;&#x3059;&#x308b;&#x5834;&#x5408;&#x306f;&#x3001;
start_stop_aws_resources &#x95a2;&#x6570;&#x3092;&#x4ee5;&#x4e0b;&#x306e;&#x3088;&#x3046;&#x306b;&#x547c;&#x3073;&#x51fa;&#x3059;&#x3002;</p>

<div class="source">
<pre><code> aws_resource_start_stop.start_stop_aws_resources(event, context, False)
</code></pre></div>
</li>
<li>

<p>&#x8a2d;&#x5b9a;&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x306e;&#x7de8;&#x96c6;</p>
<p>Lambda &#x95a2;&#x6570;&#x306e;&#x30eb;&#x30fc;&#x30c8;&#x30c7;&#x30a3;&#x30ec;&#x30af;&#x30c8;&#x30ea;&#x30fc;&#x306b;&#x914d;&#x7f6e;&#x3057;&#x305f; aws_resource_start_stop.yml
&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x3092;&#x4ee5;&#x4e0b;&#x306e;&#x3088;&#x3046;&#x306b;&#x7de8;&#x96c6;&#x3059;&#x308b;&#x3002;</p>

<div class="source">
<pre><code> region_name: &#x226a;region-name&#x226b;
 &#x226a;keyname01&#x226b;:
   - type: ec2.instance
     ids:
       - &#x226a;ec2instance-id&#x226b;
       - &#x226a;ec2instance-id&#x226b;
         ...
   - type: rds.db_cluster
     ids:
       - &#x226a;dbcluster-id&#x226b;
       - &#x226a;dbcluster-id&#x226b;
         ...
   - type: rds.db_instance
     ids:
       - &#x226a;dbinstance-id&#x226b;
       - &#x226a;dbinstance-id&#x226b;
         ...
 &#x226a;keyname02&#x226b;:
   - type: ec2.instance
     ids:
       - &#x226a;instance-id&#x226b;
     ...
</code></pre></div>
</li>
<li>

<p>CloudWatch Event &#x304b;&#x3089;&#x306e; Lambda &#x95a2;&#x6570;&#x306e;&#x547c;&#x3073;&#x51fa;&#x3057;</p>
<p>CloudWatch &#x3067;&#x30a4;&#x30d9;&#x30f3;&#x30c8;&#x306e;&#x30eb;&#x30fc;&#x30eb;&#x3092;&#x4f5c;&#x6210;&#x3057;&#x3001;&#x30bf;&#x30fc;&#x30b2;&#x30c3;&#x30c8;&#x306b;&#x5148;&#x306b;&#x4f5c;&#x6210;&#x3057;&#x305f; Lambda
&#x95a2;&#x6570;&#x3092;&#x6307;&#x5b9a;&#x3059;&#x308b;&#x3002;</p>
<ul>

<li>

<p>EC2&#x306e;&#x8d77;&#x52d5;&#xff0f;&#x505c;&#x6b62;&#x306e;&#x60c5;&#x5831;&#x3092; event &#x304b;&#x3089;&#x53d6;&#x5f97;&#x3059;&#x308b;&#x5834;&#x5408;</p>
<p>&#x30bf;&#x30fc;&#x30b2;&#x30c3;&#x30c8;&#x306e;&#x5165;&#x529b;&#x306e;&#x8a2d;&#x5b9a;&#x3067;&#x300c;&#x5b9a;&#x6570;(JSON&#x30c6;&#x30ad;&#x30b9;&#x30c8;)&#x300d;&#x3092;&#x9078;&#x629e;&#x3057;&#x3001;&#x4ee5;&#x4e0b;&#x306e;&#x3088;&#x3046;&#x306b;
&#x8a18;&#x8ff0;&#x3059;&#x308b;&#x3002;</p>

<div class="source">
<pre><code>  {&quot;action&quot;: &quot;start&quot;, &quot;configKey&quot;: &quot;&#x226a;keyname01&#x226b;&quot;}
</code></pre></div>
<p>&#x307e;&#x305f;&#x306f;</p>

<div class="source">
<pre><code>  {&quot;action&quot;: &quot;start&quot;, &quot;configKey&quot;: [&quot;&#x226a;keyname01&#x226b;&quot;, &quot;&#x226a;keyname02&#x226b;&quot;, ...]}
</code></pre></div>
<p>action &#x306b;&#x306f;&#x3001;&#x201c;start&#x201d; &#x307e;&#x305f;&#x306f; &#x201c;stop&#x201d;&#x3001;configKey&#x306b;&#x306f;&#x8a2d;&#x5b9a;&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x306b;
&#x5b9a;&#x7fa9;&#x3057;&#x305f;&#x30ad;&#x30fc;&#x306e;&#x540d;&#x524d;&#x307e;&#x305f;&#x306f;&#x540d;&#x524d;&#x306e;&#x914d;&#x5217;&#x3092;&#x6307;&#x5b9a;&#x3059;&#x308b;&#x3002;</p>
</li>
<li>

<p>EC2&#x306e;&#x8d77;&#x52d5;&#xff0f;&#x505c;&#x6b62;&#x306e;&#x60c5;&#x5831;&#x3092; Lambda &#x95a2;&#x6570;&#x540d;&#x304b;&#x3089;&#x53d6;&#x5f97;&#x3059;&#x308b;&#x5834;&#x5408;</p>
<p>&#x4ee5;&#x4e0b;&#x306e;&#x30eb;&#x30fc;&#x30eb;&#x306b;&#x5f93;&#x3063;&#x3066;Lambda &#x95a2;&#x6570;&#x540d;&#x3092;&#x6c7a;&#x3081;&#x307e;&#x3059;&#x3002;</p>
<ul>

<li>ec2_start_&#x226a;&#x8a2d;&#x5b9a;&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x306e;&#x30ad;&#x30fc;&#x226b; &#xff08;EC2&#x30a4;&#x30f3;&#x30b9;&#x30bf;&#x30f3;&#x30b9;&#x3092;&#x958b;&#x59cb;&#x3059;&#x308b;&#x5834;&#x5408;&#xff09;</li>
<li>ec2_stop_&#x226a;&#x8a2d;&#x5b9a;&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x306e;&#x30ad;&#x30fc;&#x226b; (EC2&#x30a4;&#x30f3;&#x30b9;&#x30bf;&#x30f3;&#x30b9;&#x3092;&#x505c;&#x6b62;&#x3059;&#x308b;&#x5834;&#x5408;)</li>
</ul>
</li>
</ul>
</li>
<li>

<p>&#x8a2d;&#x8a08;&#x60c5;&#x5831;</p>
</li>
</ol>
<p><img src="./doc-images/class_diagram.jpg" alt="クラス図" /></p></section></section><section>
<h2><a name="aws_s3_upload_.E3.83.A2.E3.82.B8.E3.83.A5.E3.83.BC.E3.83.AB"></a>aws_s3_upload &#x30e2;&#x30b8;&#x30e5;&#x30fc;&#x30eb;</h2>
<p>upload_file &#x95a2;&#x6570;&#x3092;&#x5b9f;&#x884c;&#x3059;&#x308b;&#x3068;&#x3001;&#x6307;&#x5b9a;&#x3055;&#x308c;&#x305f;&#x30c7;&#x30a3;&#x30ec;&#x30af;&#x30c8;&#x30ea;&#x53ca;&#x3073;&#x30b5;&#x30d6;&#x30c7;&#x30a3;&#x30ec;&#x30af;&#x30c8;&#x30ea;&#x914d;&#x4e0b;&#x306e;
&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x3059;&#x3079;&#x3066;&#x3092; S3 &#x306e;&#x30d0;&#x30b1;&#x30c3;&#x30c8;&#x306b;&#x30a2;&#x30c3;&#x30d7;&#x30ed;&#x30fc;&#x30c9;&#x3059;&#x308b;&#x3053;&#x3068;&#x304c;&#x3067;&#x304d;&#x307e;&#x3059;&#x3002;remove_src
&#x5f15;&#x6570;&#x306b; True &#x3092;&#x6307;&#x5b9a;&#x3059;&#x308b;&#x3068;&#x3001;&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x3092;S3&#x306b;&#x30a2;&#x30c3;&#x30d7;&#x30ed;&#x30fc;&#x30c9;&#x3057;&#x305f;&#x5f8c;&#x306b;&#x30a2;&#x30c3;&#x30d7;&#x30ed;&#x30fc;&#x30c9;&#x5143;&#x306e;
&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x3092;&#x524a;&#x9664;&#x3057;&#x307e;&#x3059;&#x3002;</p><section>
<h3><a name="a.E5.88.A9.E7.94.A8.E6.96.B9.E6.B3.95"></a>&#x5229;&#x7528;&#x65b9;&#x6cd5;</h3>
<ol style="list-style-type: decimal">

<li>

<p>Lambda &#x95a2;&#x6570;&#x306e;&#x4f5c;&#x6210;</p>
<ul>

<li>

<p>IAM&#x30ed;&#x30fc;&#x30eb;&#x306e;&#x8a2d;&#x5b9a;</p>
<p>Lambda &#x95a2;&#x6570;&#x304b;&#x3089;&#x3001;upload_file &#x95a2;&#x6570;&#x3092;&#x547c;&#x3073;&#x51fa;&#x3057;&#x305f;&#x3044;&#x5834;&#x5408;&#x306f;&#x3001;S3&#x30d0;&#x30b1;&#x30c3;&#x30c8;&#x306e;
&#x8aad;&#x307f;&#x8fbc;&#x307f;&#x3001;&#x66f8;&#x304d;&#x8fbc;&#x307f;&#x6a29;&#x9650;&#x3092;&#x8a2d;&#x5b9a;&#x3059;&#x308b;&#x305f;&#x3081;&#x306b;&#x3001;&#x4ee5;&#x4e0b;&#x306e; IAM &#x30dd;&#x30ea;&#x30b7;&#x30fc;&#x3092;
&#x4f5c;&#x6210;&#x3059;&#x308b;&#x3002;</p>

<div class="source">
<pre><code>  {
      &quot;Version&quot;: &quot;2012-10-17&quot;,
      &quot;Statement&quot;: [
          {
              &quot;Sid&quot;: &quot;ListObjectsInBucket&quot;,
              &quot;Effect&quot;: &quot;Allow&quot;,
              &quot;Action&quot;: [&quot;s3:ListBucket&quot;],
              &quot;Resource&quot;: [&quot;arn:aws:s3:::&lt;bucket-name&gt;&quot;]
          },
          {
              &quot;Sid&quot;: &quot;AllObjectActions&quot;,
              &quot;Effect&quot;: &quot;Allow&quot;,
              &quot;Action&quot;: &quot;s3:*Object&quot;,
              &quot;Resource&quot;: [&quot;arn:aws:s3:::&lt;bucket-name&gt;/*&quot;]
          }
      ]
  }
</code></pre></div>
<p>&lt;backat-name&gt;&#x306b;&#x306f;&#x3001;&#x30a2;&#x30af;&#x30bb;&#x30b9;&#x3092;&#x8a31;&#x53ef;&#x3059;&#x308b;&#x30d0;&#x30b1;&#x30c3;&#x30c8;&#x540d;&#x3092;&#x6307;&#x5b9a;&#x3059;&#x308b;&#x3002;&#x5168;&#x3066;&#x306e;
&#x30d0;&#x30b1;&#x30c3;&#x30c8;&#x306b;&#x8a31;&#x53ef;&#x3059;&#x308b;&#x5834;&#x5408;&#x306f;&#x3001;&lt;backat-name&gt;&#x306e;&#x90e8;&#x5206;&#x306b;&#x300c;*&#x300d;&#x3092;&#x6307;&#x5b9a;&#x3059;&#x308b;&#x3002;</p>
</li>
<li>

<p>Lambda &#x95a2;&#x6570;&#x306e;&#x4f5c;&#x6210;</p>
<p>Lambda &#x95a2;&#x6570;&#x3092;&#x4f5c;&#x6210;&#x3057;&#x3066;&#x3001;Lambda &#x95a2;&#x6570;&#x306b;&#x9069;&#x7528;&#x3057;&#x305f;&#x30ed;&#x30fc;&#x30eb;&#x306b;&#x5bfe;&#x3057;&#x3066;&#x4e0a;&#x8a18;&#x3067;&#x4f5c;&#x6210;&#x3057;&#x305f;
IAM &#x30ed;&#x30fc;&#x30eb;&#x3092;&#x30a2;&#x30bf;&#x30c3;&#x30c1;&#x3059;&#x308b;&#x3002;</p>
</li>
<li>

<p>EFS&#x3078;&#x306e;&#x30a2;&#x30af;&#x30bb;&#x30b9;&#x306e;&#x8a2d;&#x5b9a;</p>
<p>&#x30a2;&#x30c3;&#x30d7;&#x30ed;&#x30fc;&#x30c9;&#x5143;&#x306e;&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x304c;EFS&#x306b;&#x914d;&#x7f6e;&#x3055;&#x308c;&#x3066;&#x3044;&#x308b;&#x5834;&#x5408;&#x306f;&#x3001;Lambda&#x95a2;&#x6570;&#x304c;EFS&#x306b;
&#x30a2;&#x30af;&#x30bb;&#x30b9;&#x3067;&#x304d;&#x308b;&#x3088;&#x3046;&#x306b;&#x3059;&#x308b;&#x305f;&#x3081;&#x306e;&#x8a2d;&#x5b9a;&#x3092;&#x3059;&#x308b;&#x3002;&#x624b;&#x9806;&#x306f;&#x4e0b;&#x8a18;&#x306e;&#x30da;&#x30fc;&#x30b8;&#x3092;&#x53c2;&#x7167;&#x306e;&#x3053;&#x3068;&#x3002;</p>
<ul>

<li><a class="externalLink" href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/configuration-filesystem.html">Lambda &#x95a2;&#x6570;&#x306e;&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x30b7;&#x30b9;&#x30c6;&#x30e0;&#x30a2;&#x30af;&#x30bb;&#x30b9;&#x306e;&#x8a2d;&#x5b9a;</a></li>
<li><a class="externalLink" href="https://dev.classmethod.jp/articles/lambda-support-for-amazon-elastic-file-system/">[&#x30a2;&#x30c3;&#x30d7;&#x30c7;&#x30fc;&#x30c8;] Lambda &#x304b;&#x3089;&#x5171;&#x6709;&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x30b9;&#x30c8;&#x30ec;&#x30fc;&#x30b8;&#x306e; EFS &#x304c;&#x5229;&#x7528;&#x53ef;&#x80fd;&#x306b;&#x306a;&#x308a;&#x307e;&#x3057;&#x305f;</a></li>
</ul>
</li>
</ul>
</li>
<li>

<p>aws_s3_upload &#x30e2;&#x30b8;&#x30e5;&#x30fc;&#x30eb;&#x306e;&#x914d;&#x5099;</p>
<p>&#x30d7;&#x30ed;&#x30b8;&#x30a7;&#x30af;&#x30c8; &#x30c7;&#x30a3;&#x30ec;&#x30af;&#x30c8;&#x30ea;&#x30fc;&#x306b;&#x4ee5;&#x4e0b;&#x306e;&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x3092;&#x914d;&#x5099;&#x3059;&#x308b;&#x3002;</p>
<ul>

<li>aws_s3_upload.py</li>
<li>aws_s3_upload.yml</li>
<li>&#x30e2;&#x30b8;&#x30e5;&#x30fc;&#x30eb;&#x306e;&#x4f9d;&#x5b58;&#x30d1;&#x30c3;&#x30b1;&#x30fc;&#x30b8;</li>
</ul>
<p>&#x4f9d;&#x5b58;&#x30d1;&#x30c3;&#x30b1;&#x30fc;&#x30b8;&#x306f;&#x3001;&#x30d7;&#x30ed;&#x30b8;&#x30a7;&#x30af;&#x30c8; &#x30c7;&#x30a3;&#x30ec;&#x30af;&#x30c8;&#x30ea;&#x30fc;&#x914d;&#x4e0b;&#x306b; &#x300c;requirements.txt&#x300d;&#x3092;
&#x914d;&#x7f6e;&#x3057;&#x3066;&#x3001;&#x30d7;&#x30ed;&#x30b8;&#x30a7;&#x30af;&#x30c8; &#x30c7;&#x30a3;&#x30ec;&#x30af;&#x30c8;&#x30ea;&#x30fc;&#x3067;&#x4ee5;&#x4e0b;&#x306e;&#x30b3;&#x30de;&#x30f3;&#x30c9;&#x3092;&#x5b9f;&#x884c;&#x3057;&#x3066;&#x53d6;&#x5f97;&#x3059;&#x308b;&#x3002;</p>

<div class="source">
<pre><code> python -m pip install -t . -r requirements.txt
</code></pre></div>
</li>
<li>

<p>upload_file &#x95a2;&#x6570;&#x306e;&#x547c;&#x3073;&#x51fa;&#x3057;</p>
<p>Lambda &#x95a2;&#x6570;&#x306e;&#x30d7;&#x30ed;&#x30b8;&#x30a7;&#x30af;&#x30c8; &#x30c7;&#x30a3;&#x30ec;&#x30af;&#x30c8;&#x30ea;&#x30fc;&#x914d;&#x4e0b;&#x306e;&#x300c;lambda_function.py&#x300d;
&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x306b;&#x4ee5;&#x4e0b;&#x306e;&#x30b3;&#x30fc;&#x30c9;&#x3092;&#x5b9f;&#x88c5;&#x3059;&#x308b;&#x3002;</p>

<div class="source">
<pre><code> import aws_s3_upload
 import logging
 import sys
 import traceback

 root = logging.getLogger()
 if root.handlers:
     for handler in root.handlers:
         root.removeHandler(handler)
 logging.basicConfig(stream=sys.stdout, level=logging.INFO)

 def lambda_handler(event, context):
     try:
         # &#x30a2;&#x30c3;&#x30d7;&#x30ed;&#x30fc;&#x30c9;&#x5143;&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x3092;&#x914d;&#x7f6e;&#x3057;&#x305f;&#x30c7;&#x30a3;&#x30ec;&#x30af;&#x30c8;&#x30ea;
         srcdir = '/path/to/source_dir'
         # &#x30a2;&#x30c3;&#x30d7;&#x30ed;&#x30fc;&#x30c9;&#x5148;&#x306e;S3&#x30d0;&#x30b1;&#x30c3;&#x30c8;&#x540d;
         bucket_name = 'my_bucket'
         # &#x683c;&#x7d0d;&#x5148;&#x306e;S3&#x30aa;&#x30d6;&#x30b8;&#x30a7;&#x30af;&#x30c8;&#x30fb;&#x30ad;&#x30fc;&#x306e;&#x30d7;&#x30ec;&#x30d5;&#x30a3;&#x30c3;&#x30af;&#x30b9;
         key_prefix = 'folder1/folder2'
         # &#x30a2;&#x30c3;&#x30d7;&#x30ed;&#x30fc;&#x30c9;&#x5f8c;&#x306b;&#x30a2;&#x30c3;&#x30d7;&#x30ed;&#x30fc;&#x30c9;&#x5143;&#x306e;&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x3092;&#x524a;&#x9664;&#x3057;&#x306a;&#x3044;
         remove_src = 'False'
         # &#x30a2;&#x30c3;&#x30d7;&#x30ed;&#x30fc;&#x30c9;&#x5143;&#x30d5;&#x30a9;&#x30eb;&#x30c0;&#x914d;&#x4e0b;&#x306e;&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x3092;&#x518d;&#x5e30;&#x7684;&#x306b;S3&#x30d0;&#x30b1;&#x30c3;&#x30c8;&#x306b;&#x683c;&#x7d0d;&#x3059;&#x308b;
         # &#x683c;&#x7d0d;&#x5148;&#x306e;S3&#x30aa;&#x30d6;&#x30b8;&#x30a7;&#x30af;&#x30c8;&#x306e;&#x30ad;&#x30fc;&#x306f;&#x3001;
         #     &#x30ad;&#x30fc;&#x306e;&#x30d7;&#x30ec;&#x30d5;&#x30a3;&#x30c3;&#x30af;&#x30b9;+'/'+&#x30a2;&#x30c3;&#x30d7;&#x30ed;&#x30fc;&#x30c9;&#x5143;&#x30c7;&#x30a3;&#x30ec;&#x30af;&#x30c8;&#x30ea;&#x7a7a;&#x306e;&#x76f8;&#x5bfe;&#x30d1;&#x30b9;
         # &#x3068;&#x306a;&#x308b;
         aws_s3_upload.upload_file(srcdir, bucket_name, key_prefix,
                 'true'==remove_src.lower() if remove_src != None else False)
     except Exception as cm:
         logging.error(str(cm.__class__) + ': ' +  str(cm))
         traceback.print_stack(file=sys.stdout)
         raise
</code></pre></div>
</li>
<li>

<p>&#x8a2d;&#x5b9a;&#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x306e;&#x7de8;&#x96c6;</p>
<p>aws_s3_upload.yml &#x30d5;&#x30a1;&#x30a4;&#x30eb;&#x3092;&#x4ee5;&#x4e0b;&#x306e;&#x3088;&#x3046;&#x306b;&#x7de8;&#x96c6;&#x3059;&#x308b;&#x3002;</p>

<div class="source">
<pre><code> region_name: &#x226a;region_name&#x226b;
 access_key_id: &#x226a;access_key_id&#x226b; &#xff08;&#x30aa;&#x30d7;&#x30b7;&#x30e7;&#x30f3;&#xff09;
 secret_access_key: &#x226a;secret_access_key&#x226b; &#xff08;&#x30aa;&#x30d7;&#x30b7;&#x30e7;&#x30f3;&#xff09;
</code></pre></div>
</li>
</ol></section></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2024ycookjp my project.
.      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
